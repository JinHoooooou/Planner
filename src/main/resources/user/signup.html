<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <link rel="stylesheet" href="../css/signup.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" 
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
<form id="signup">
    <label for="userId">ID 입력:</label>
    <input type="text" id="userId" name="userId" placeholder="ID를 입력해주세요." required>
    <div class="idarea" id="idarea"></div>
    <button type="button" id="idcheckDuplicateBtn" class="checkDuplicateBtn">중복확인</button> 

    <label for="userPw">비밀번호 입력:</label>
    <input type="password" id="userPw" name="userPw" placeholder="비빌번호를 입력해주세요." required>
    <div class="pwarea" id="pwarea"></div>

    <label for="userPwConfirm">비밀번호 확인:</label>
    <input type="password" id="userPwConfirm" name="userPwConfirm" placeholder="비밀번호를 한 번 더 입력해주세요." required>

    <label for="userName">이름:</label>
    <input type="text" id="userName" name="userName" placeholder="본인의 성함을 입력해주세요." required>

    <label for="nickname">닉네임:</label>
    <input type="text" id="nickname" name="nickname" placeholder="사용하실 닉네임을 입력해주새요." required>
    <div class="nnarea" id="nnarea"></div>
    <button type="button" id="nicknamecheckDuplicateBtn" class="checkDuplicateBtn">중복확인</button> 
    

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" placeholder="본인의 Email을 입력해주세요." required>

    <label for="phone">휴대폰번호:</label>
    <input type="text" id="phone" name="phone" placeholder="본인의 휴대폰번호를 입력해주세요." required>

    <input type="submit" value="회원가입">
</form>

<script>
    
    $('#idcheckDuplicateBtn').click(function(event) {
        let userId = $('#userId').val();
        const reg = /^[A-Za-z][A-Za-z0-9_]{7,16}$/;
        if (!reg.test($('#userId').val())){
            alert("유효한 아이디가 아닙니다.");
            $('#idarea').html("영문자로 시작해야 하며 8~16자의 영문자, 숫자, _를 사용해야합니다.")
        } else {
            $.ajax({
                url: `/user/signup/userid/duplicate?userId=${userId}`,
                type: "GET",
                success: function (response, textStatus, xhr){
                    alert("사용 가능한 아이디입니다.");
                    $('#idarea').html("")
                },
                error: function (xhr, textStatus, errorThrown) {
                    if (xhr.status == 400) {
                        alert("유효한 아이디가 아닙니다.");
                    } else if (xhr.status == 403) {
                        alert("이미 사용중인 아이디 입니다.");
                    }
                }
            })
        }
    });

    $('#nicknamecheckDuplicateBtn').click(function(event) {
        let nickname = $('#nickname').val();
        const reg = /^[가-힣a-zA-Z0-9]{3,20}$/;
        if (!reg.test($('#nickname').val())){
            alert("유효한 닉네임이 아닙니다.")
            $('#nnarea').html("3~20자의 한글, 영문, 숫자를 사용해야합니다");
        } else {
            $.ajax({
                url:`/user/signup/nickname/duplicate?nickname=${nickname}`,
                type: "GET",
                success: function (response, textStatus, xhr){
                    alert("사용 가능한 닉네임입니다.");
                    $('#nnarea').html("");
                },
                error: function (xhr, textStatus, errorThrown) {
                    if (xhr.status == 400) {
                        alert("유효한 닉네임이 아닙니다.")
                    } else if (xhr.status == 403) {
                        alert("이미 사용중인 닉네임 입니다.")
                    }
                }  
                })
        }
    });
    $(document).ready(function () {
    $('form').submit(function(event) {
        event.preventDefault();
        const reg = /^(?=.*[a-zA-Z])(?=.*[0-9]).{8,25}$/;

        if (!reg.test($('#userPw').val())) {
            $('#pwarea').html("영문, 숫자 조합 8~25자리 이상 입력하시오.");
        } else if ($('#userPw').val() != $('#userPwConfirm').val()) {
            alert("비밀번호가 일치하지 않습니다"); 
            $('#pwarea').html("");
        } else {
            let formData = $(this).serialize();
            $.ajax({
                url: "/user/signup",
                type: "POST",
                contentType: "application/x-www-form-urlencoded",
                data: formData,
                success: function (response, textStatus, xhr) {
                    alert("회원가입이 완료되었습니다"); 
                    document.location.href='./signin.html';
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert("회원가입에 실패하셨습니다"); 
                },
            });
        }
        });
    });
    
</script>

</body>
</html>
